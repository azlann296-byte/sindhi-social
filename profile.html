<!DOCTYPE html>
<html lang="sd">
<head>
  <meta charset="UTF-8">
  <title>Profile</title>

  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

  <style>
    body {
      font-family: Arial;
      background: #f4f4f4;
      padding: 20px;
    }
    .card {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      max-width: 400px;
      margin: auto;
    }
    img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
    }
    textarea, input {
      width: 100%;
      margin-top: 10px;
      padding: 8px;
    }
    button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      background: green;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="card">
  <h3>Profile Picture</h3>
  <img id="profilePic" src="" alt="Profile">
  <input type="file" id="imageInput">

  <h3 id="userName">Ù†Ø§Ù„Ùˆ Ù‡ØªÙŠ Ø§ÙŠÙ†Ø¯Ùˆ</h3>

  <textarea id="bio" placeholder="Ù¾Ù†Ù‡Ù†Ø¬ÙŠ Ø¨Ø§Ø±ÙŠ Û¾ Ù„Ú©Ùˆ..."></textarea>
  <button onclick="saveProfile()">Ø¨Ø±ÙˆÙØ§Ø¦ÙŠÙ„ Ø§ÙŠÚŠÙ½ ÚªØ±ÙŠÙˆ</button>

  <hr>

  <h3>Ø§Ú„ Ú‡Ø§ Ø´ÙŠØ¦Ø± ÚªØ±Ú» Ú†Ø§Ù‡ÙŠÙˆ Ù¿Ø§ØŸ</h3>
  <textarea id="postText" placeholder="Ù‡ØªÙŠ Ù„Ú©Ùˆ..."></textarea>
  <button onclick="createPost()">Post ÚªØ±ÙŠÙˆ</button>

  <div id="posts"></div>
</div>

<script>
  // ğŸ”¥ Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyAZZohvUQwCVCELZOF9sP_ISl7EPxP1p8E",
    authDomain: "sindhisocial-cc8ad.firebaseapp.com",
    projectId: "sindhisocial-cc8ad",
    storageBucket: "sindhisocial-cc8ad.appspot.com",
    appId: "1:1059274290288:web:6c1d41f1aa657bd5e030b5"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  // ğŸ‘¤ Load user
  auth.onAuthStateChanged(user => {
    if (!user) {
      window.location.href = "index.html";
    } else {
      document.getElementById("userName").innerText = user.displayName;
      loadProfile(user.uid);
      loadPosts();
    }
  });

  // ğŸ’¾ Save Bio + Image
  function saveProfile() {
    const user = auth.currentUser;
    const bio = document.getElementById("bio").value;
    const file = document.getElementById("imageInput").files[0];

    if (file) {
      const ref = storage.ref("profiles/" + user.uid + "_" + Date.now());

      ref.put(file).then(() => {
        ref.getDownloadURL().then(url => {
          db.collection("users").doc(user.uid).set({
            bio: bio,
            photo: url
          });
          document.getElementById("profilePic").src = url;
          alert("Profile Updated âœ”ï¸");
        });
      });
    } else {
      db.collection("users").doc(user.uid).update({ bio: bio });
      alert("Bio Saved âœ”ï¸");
    }
  }

  // ğŸ“¥ Load Profile
  function loadProfile(uid) {
    db.collection("users").doc(uid).get().then(doc => {
      if (doc.exists) {
        document.getElementById("bio").value = doc.data().bio || "";
        if (doc.data().photo) {
          document.getElementById("profilePic").src = doc.data().photo;
        }
      }
    });
  }

  // ğŸ“ Create Post
  function createPost() {
    const text = document.getElementById("postText").value;
    const user = auth.currentUser;

    if (text === "") {
      alert("ÚªØ¬Ù‡Ù‡ Ù„Ú©Ùˆ");
      return;
    }

    db.collection("posts").add({
      text: text,
      name: user.displayName,
      time: firebase.firestore.FieldValue.serverTimestamp()
    });

    document.getElementById("postText").value = "";
    loadPosts();
  }

  // ğŸ“ƒ Load Posts
  function loadPosts() {
    const postsDiv = document.getElementById("posts");
    postsDiv.innerHTML = "";

    db.collection("posts").orderBy("time", "desc").get().then(snapshot => {
      snapshot.forEach(doc => {
        postsDiv.innerHTML += `
          <p><b>${doc.data().name}</b><br>${doc.data().text}</p><hr>
        `;
      });
    });
  }
</script>
<script>
function saveProfile() {
  const user = firebase.auth().currentUser;
  const bio = document.getElementById("bio").value;
  const file = document.getElementById("imageInput").files[0];

  if (!file) {
    alert("ØªØµÙˆÙŠØ± Ú†ÙˆÙ†ÚŠÙŠÙˆ");
    return;
  }

  const ref = firebase.storage().ref(
    "profiles/" + user.uid + "_" + Date.now()
  );

  ref.put(file).then(() => {
    ref.getDownloadURL().then((url) => {
      firebase.firestore().collection("users").doc(user.uid).set(
        {
          bio: bio,
          photo: url
        },
        { merge: true }
      );

      // ğŸ”¥ FORCE refresh image
      document.getElementById("profilePic").src = url + "?v=" + Date.now();

      alert("Profile picture updated âœ”ï¸");
    });
  });
}
</script>

</body>
</html>


